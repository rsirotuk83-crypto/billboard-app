<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBCB World Billboard</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        :root { --neon: #00f2ff; --pink: #ff00e5; --gold: #fbff00; }
        body { background: #050505; color: white; font-family: 'Inter', system-ui, sans-serif; margin: 0; padding: 15px; text-align: center; line-height: 1.5; }
        .card { border: 2px solid var(--neon); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 0 20px rgba(0,242,255,0.2); background: linear-gradient(145deg, #0a0a0a, #000); position: relative; }
        .vip { border: 3px solid var(--pink); box-shadow: 0 0 30px rgba(255,0,229,0.3); }
        .jackpot { font-size: 36px; color: var(--gold); text-shadow: 0 0 15px var(--gold); margin: 10px 0; font-weight: 800; }
        .btn { background: white; color: black; border: none; padding: 16px; border-radius: 50px; font-weight: bold; cursor: pointer; width: 100%; font-size: 14px; text-transform: uppercase; transition: 0.3s; margin-top: 10px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,255,255,0.2); }
        .input-text { width: 90%; padding: 14px; border-radius: 12px; border: 1px solid #333; background: #111; color: white; margin-bottom: 12px; outline: none; font-size: 16px; }
        #ton-connect-button { display: flex; justify-content: center; margin-bottom: 25px; }
        .status-tag { font-size: 10px; background: #222; padding: 4px 10px; border-radius: 10px; color: #888; letter-spacing: 1px; }
        
        #rules-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; padding: 20px; box-sizing: border-box; }
        .rules-content { background: #111; border: 1px solid var(--neon); padding: 25px; border-radius: 20px; text-align: left; max-width: 500px; margin: auto; }
    </style>
</head>
<body>
    <div id="ton-connect-button"></div>

    <div class="card vip">
        <span class="status-tag" id="t-vip-label">ðŸ‘‘ WORLD DOMINATION</span>
        <div class="jackpot" id="jackpot-val">1.00 TON</div>
        <div id="vip-text" style="font-size: 22px; margin: 15px 0; font-weight: 600; min-height: 1.2em;">...</div>
        <input type="text" id="new-vip-text" class="input-text">
        <button class="btn" style="background: var(--pink); color: white;" id="t-btn-vip" onclick="payVip()"></button>
    </div>

    <div class="card">
        <span class="status-tag" id="t-stars-label">ðŸ“¢ PUBLIC BROADCAST</span>
        <div id="main-text" style="font-size: 18px; margin: 15px 0; color: #ccc;">...</div>
        <input type="text" id="new-main-text" class="input-text">
        <button class="btn" id="t-btn-stars" onclick="buyStars()"></button>
    </div>

    <div style="display: flex; gap: 10px;">
        <button class="btn" style="background: transparent; color: var(--neon); border: 1px solid var(--neon);" id="t-btn-share" onclick="shareApp()"></button>
        <button class="btn" style="background: transparent; color: white; border: 1px solid #444;" id="t-btn-rules" onclick="toggleRules(true)"></button>
    </div>

    <div id="rules-modal">
        <div class="rules-content">
            <h2 id="t-r-title">Rules</h2>
            <div id="t-r-body" style="color: #bbb; font-size: 14px;"></div>
            <button class="btn" onclick="toggleRules(false)" style="margin-top:20px;">I UNDERSTAND</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Automatic Language & UI adaptation
        const userLang = tg.initDataUnsafe.user?.language_code || 'en';
        const i18n = {
            en: {
                vip: "ðŸ‘‘ GLOBAL HEGEMONY", stars: "ðŸ“¢ PUBLIC AD",
                btnVip: "Seize the Throne", btnStars: "Buy Airtime (50 Stars)",
                btnShare: "Share My Fame", btnRules: "Manual",
                vipPl: "Your legendary message...", starsPl: "Your advertisement...",
                rTitle: "Billboard Manual",
                rBody: "1. Pay TON to replace the TOP message. 2. Each bid must be +1 TON higher. 3. Stars ad is instant and global for 50 Stars."
            },
            uk: {
                vip: "ðŸ‘‘ Ð¡Ð’Ð†Ð¢ÐžÐ’Ð Ð“Ð•Ð“Ð•ÐœÐžÐÐ†Ð¯", stars: "ðŸ“¢ ÐŸÐ£Ð‘Ð›Ð†Ð§ÐÐ˜Ð™ Ð•Ð¤Ð†Ð ",
                btnVip: "Ð—Ð°Ñ…Ð¾Ð¿Ð¸Ñ‚Ð¸ Ð¢Ñ€Ð¾Ð½", btnStars: "ÐšÑƒÐ¿Ð¸Ñ‚Ð¸ ÐµÑ„Ñ–Ñ€ (50 Stars)",
                btnShare: "Ð¥Ð¸Ð·ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ", btnRules: "Ð¯Ðº Ñ†Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÑ”?",
                vipPl: "Ð¢Ð²Ð¾Ñ” Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ðµ Ð¿Ð¾ÑÐ»Ð°Ð½Ð½Ñ...", starsPl: "Ð¢Ð²Ð¾Ñ Ñ€ÐµÐºÐ»Ð°Ð¼Ð°...",
                rTitle: "Ð†Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ",
                rBody: "1. Ð¡Ð¿Ð»Ð°Ñ‚Ð¸ TON, Ñ‰Ð¾Ð± Ð·Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸ Ð³Ð¾Ð»Ð¾Ð²Ð½Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚. 2. ÐšÐ¾Ð¶Ð½Ð° Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð° ÑÑ‚Ð°Ð²ÐºÐ° Ð¼Ð°Ñ” Ð±ÑƒÑ‚Ð¸ Ð½Ð° 1 TON Ð²Ð¸Ñ‰Ð¾ÑŽ. 3. Ð ÐµÐºÐ»Ð°Ð¼Ð° Ð·Ð° Stars Ð¾Ð½Ð¾Ð²Ð»ÑŽÑ”Ñ‚ÑŒÑÑ Ð¼Ð¸Ñ‚Ñ‚Ñ”Ð²Ð¾."
            }
        };

        const t = i18n[userLang] || i18n['en'];
        
        // Populate UI
        document.getElementById('t-vip-label').innerText = t.vip;
        document.getElementById('t-stars-label').innerText = t.stars;
        document.getElementById('t-btn-vip').innerText = t.btnVip;
        document.getElementById('t-btn-stars').innerText = t.btnStars;
        document.getElementById('t-btn-share').innerText = t.btnShare;
        document.getElementById('t-btn-rules').innerText = t.btnRules;
        document.getElementById('new-vip-text').placeholder = t.vipPl;
        document.getElementById('new-main-text').placeholder = t.starsPl;
        document.getElementById('t-r-title').innerText = t.rTitle;
        document.getElementById('t-r-body').innerHTML = t.rBody;

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://rsirotuk83-crypto.github.io/billboard-app/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-button'
        });

        async function updateData() {
            try {
                const res = await fetch('https://billboard-bot-production.up.railway.app/status');
                const data = await res.json();
                document.getElementById('vip-text').innerText = data.vip_text;
                document.getElementById('main-text').innerText = data.main_text;
                document.getElementById('jackpot-val').innerText = data.jackpot.toFixed(2) + " TON";
            } catch(e) {}
        }

        function toggleRules(show) { document.getElementById('rules-modal').style.display = show ? 'block' : 'none'; }
        
        function buyStars() {
            const text = document.getElementById('new-main-text').value;
            if (!text) return tg.HapticFeedback.notificationOccurred('error');
            tg.sendData(`action:buy_stars|text:${text}`);
        }

        async function payVip() {
            if (!tonConnectUI.connected) return alert("Connect Wallet!");
            const text = document.getElementById('new-vip-text').value;
            if (!text) return;

            const comment = btoa(encodeURIComponent(text).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode('0x' + p1)));

            const transaction = {
                validUntil: Math.floor(Date.now() / 1000) + 600,
                messages: [{
                    address: "UQCa_nSo4WIgb6vSm5IRmuuVSdl9c9JD-pOqA8ybK6TjMQpL",
                    amount: "1000000000",
                    payload: comment 
                }]
            };
            try { await tonConnectUI.sendTransaction(transaction); } catch(e) {}
        }

        function shareApp() {
            const botUrl = "https://t.me/my_billboard_wbcb_bot";
            tg.openTelegramLink(`https://t.me/share/url?url=${botUrl}&text=${encodeURIComponent("I just conquered the World Billboard! Try to beat me! ðŸš€")}`);
        }

        setInterval(updateData, 5000);
        updateData();
    </script>
</body>
</html>
